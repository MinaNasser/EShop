<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Dashboard | Pointai</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        .cart-icon {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
        }
        .cart-count {
            background-color: red;
            color: white;
            font-size: 14px;
            border-radius: 50%;
            padding: 5px 8px;
            position: absolute;
            top: -5px;
            right: -5px;
        }
        .cart-container {
            margin-top: 20px;
        }
    </style>
</head>
<body class="client-dashboard">

    <div class="container mt-5 text-center">
        <h1 class="mb-4">Client Dashboard</h1>
        <p>Welcome, valued client! üéâ</p>
        
        <!-- ÿ≤ÿ± ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ -->
        <button class="btn btn-danger" onclick="logout()">Logout</button>

        <!-- ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑÿ≥ŸÑÿ© -->
        <div class="cart-icon" onclick="toggleCart()">
            üõí <span id="cart-count" class="cart-count">0</span>
        </div>

        <!-- ÿ≥ŸÑÿ© ÿßŸÑŸÖÿ¥ÿ™ÿ±Ÿäÿßÿ™ -->
        <div id="cart-container" class="cart-container d-none">
            <h3 class="text-primary">Shopping Cart</h3>
            <p id="cart-loading-text">Loading cart...</p>
            <div id="cart-items" class="row">
                <!-- ÿ≥Ÿäÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸáŸÜÿß -->
            </div>
        </div>
    </div>

</body>
<!-- <script>
    document.addEventListener("DOMContentLoaded", function () {
        updateCartCount(); // ‚úÖ ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿØ ÿßŸÑÿπŸÜÿßÿµÿ± ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
        loadCartItems(); // ‚úÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿπŸÜÿØ ŸÅÿ™ÿ≠ ÿßŸÑÿµŸÅÿ≠ÿ©
    });

    // ‚úÖ ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿØ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÅŸä ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑÿ≥ŸÑÿ©
    function updateCartCount() {
        fetch("http://localhost:5044/api/cart/count", {
            method: "GET",
            headers: {
                "Authorization": `Bearer ${localStorage.getItem("token")}`,
                "Content-Type": "application/json"
            }
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById("cart-count").innerText = data.count || 0;
        })
        .catch(error => console.error("Error fetching cart count:", error));
    }

    // ‚úÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿØÿßÿÆŸÑ ÿßŸÑÿ≥ŸÑÿ©
    function loadCartItems() {
        fetch("http://localhost:5044/api/CartItem/index", {
            method: "GET",
            headers: {
                "Authorization": `Bearer ${localStorage.getItem("token")}`,
                "Content-Type": "application/json"
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error("Failed to fetch cart items");
            }
            return response.json();
        })
        .then(cartItems => {
            let cartContainer = document.getElementById("cart-items");
            let loadingText = document.getElementById("cart-loading-text");
            loadingText.style.display = "none"; // ‚úÖ ÿ•ÿÆŸÅÿßÿ° ÿ±ÿ≥ÿßŸÑÿ© "Loading..."

            cartContainer.innerHTML = ""; // ‚úÖ ÿ™ŸÅÿ±Ÿäÿ∫ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ŸÇÿ®ŸÑ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©

            if (!Array.isArray(cartItems) || cartItems.length === 0) {
                cartContainer.innerHTML = `<p class="text-muted">Your cart is empty.</p>`;
                return;
            }

            cartItems.forEach(item => {
                let cartItem = document.createElement("div");
                cartItem.className = "col-md-4 mb-4";
                cartItem.innerHTML = `
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">${item.productName}</h5>
                            <p class="card-text"><strong>Product ID:</strong> ${item.productId}</p>
                            <button class="btn btn-danger" onclick="removeFromCart(${item.id})">Remove</button>
                        </div>
                    </div>
                `;
                cartContainer.appendChild(cartItem);
            });
        })
        .catch(error => {
            console.error("Error fetching cart items:", error);
            document.getElementById("cart-items").innerHTML = `<p class="text-danger">Failed to load cart items.</p>`;
        });
    }

    // ‚úÖ ÿ•ÿ≤ÿßŸÑÿ© ŸÖŸÜÿ™ÿ¨ ŸÖŸÜ ÿßŸÑÿ≥ŸÑÿ©
    function removeFromCart(itemId) {
        fetch(`http://localhost:5044/api/CartItem/remove?id=${itemId}`, {
            method: "POST",
            headers: {
                "Authorization": `Bearer ${localStorage.getItem("token")}`,
                "Content-Type": "application/json"
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error("Failed to remove item");
            }
            return response.json();
        })
        .then(() => {
            alert("Item removed from cart!");
            updateCartCount(); // ‚úÖ ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿØ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ®ÿπÿØ ÿßŸÑÿ≠ÿ∞ŸÅ
            loadCartItems(); // ‚úÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™
        })
        .catch(error => console.error("Error removing item:", error));
    }

    // ‚úÖ ÿ•ÿ∏Ÿáÿßÿ±/ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿ≥ŸÑÿ©
    function toggleCart() {
        let cartContainer = document.getElementById("cart-container");
        cartContainer.classList.toggle("d-none");
    }

    // ‚úÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨
    function logout() {
        localStorage.removeItem("token");
        window.location.href = "index.html";
    }
</script> -->






    <script>
        document.addEventListener("DOMContentLoaded", function () {
            updateCartCount();
            loadCartItems();
        });

        fetch("http://localhost:5044/api/cart/count", {
    method: "GET",
    headers: {
        "Authorization": `Bearer ${localStorage.getItem("token")}`,
        "Content-Type": "application/json"
    }
})


        function loadCartItems() {
            fetch("http://localhost:5044/api/CartItem/index", {
                method: "GET",
                headers: {
                    "Authorization": `Bearer ${localStorage.getItem("token")}`
                }
            })
            .then(response => response.json())
            .then(cartItems => {
                let cartContainer = document.getElementById("cart-items");
                let loadingText = document.getElementById("cart-loading-text");
                loadingText.style.display = "none";

                if (cartItems.length === 0) {
                    cartContainer.innerHTML = `<p class="text-muted">Your cart is empty.</p>`;
                    return;
                }

                cartItems.forEach(item => {
                    let cartItem = document.createElement("div");
                    cartItem.className = "col-md-4 mb-4";
                    cartItem.innerHTML = `
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">${item.productName}</h5>
                                <p class="card-text"><strong>Product ID:</strong> ${item.productId}</p>
                                <button class="btn btn-danger" onclick="removeFromCart(${item.id})">Remove</button>
                            </div>
                        </div>
                    `;
                    cartContainer.appendChild(cartItem);
                });
            })
            .catch(error => console.error("Error fetching cart items:", error));
        }

        function removeFromCart(itemId) {
            fetch(`http://localhost:5044/api/CartItem/remove?id=${itemId}`, {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${localStorage.getItem("token")}`
                }
            })
            .then(response => response.json())
            .then(() => {
                alert("Item removed from cart!");
                location.reload();
            })
            .catch(error => console.error("Error removing item:", error));
        }

        function toggleCart() {
            let cartContainer = document.getElementById("cart-container");
            cartContainer.classList.toggle("d-none");
        }

        function logout() {
            localStorage.removeItem("token");
            window.location.href = "index.html";
        }
    </script> 

</html>
